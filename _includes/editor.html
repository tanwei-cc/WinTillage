<div class="editor">
    <div>
        <a class="btn btn-clear btn-default btn-sm">清空</a>
        <a class="btn btn-img-preview btn-primary btn-sm">图片预览</a>
        <!-- <a class="btn btn-only-img btn-primary btn-sm">只要图片</a> -->
        &nbsp;&nbsp;
        <span class="text-muted">复制内容：点击编辑器Command + C</span>
    </div><br>
    <textarea></textarea>
</div>
<script>
    $(function() {
        var key = 'editor';
        var container = $('.' + key);
        var textareaEl = container.find('>textarea');
        var btnClearEl = container.find('.btn-clear');
        var btnImgPreviewEl = container.find('.btn-img-preview');
        // var btnOnlyImgEl = container.find('.btn-only-img');
        var config = {
            htmlRemoveTags: ['script', 'style', 'base', 'iframe'],
            htmlDoNotWrapTags: ['script', 'style'],
            htmlExecuteScripts: false
        };
        var viewer;
        var getCacheData = function() {
            return localStorage[key + '_content'] || '';
        };
        var setCacheData = function(val) {
            localStorage[key + '_content'] = val || '';
        };
        var initViewew = function() {
            try {
                if (!viewer) {
                    viewer = new Viewer(container.find('.fr-view')[0]);
                    container.find('.fr-view').on('hidden', function() {
                        viewer.destroy();
                    });
                    viewer.show();
                } else {
                    viewer.update();
                    viewer.show();
                }
            } catch (ex) {}
        };
        var initEditor = function() {
            var cacheData = getCacheData();

            textareaEl.froalaEditor('destroy');
            textareaEl.val('');
            textareaEl.on('froalaEditor.contentChanged', function(ev, editor) {
                setCacheData(editor.html.get());
                // }).on('froalaEditor.image.loaded', function(ev, editor) {
                //     initViewew();
            });
            textareaEl.froalaEditor({
                htmlRemoveTags: ['script', 'style', 'base'],
                htmlExecuteScripts: false
            });
            cacheData && textareaEl.froalaEditor('html.insert', cacheData, true);
        };

        initEditor();

        btnClearEl.click(function() {
            setCacheData('');
            initEditor();
        });

        btnImgPreviewEl.click(function() {
            initViewew();
        });

        // btnOnlyImgEl.click(function() {
        //     var html = textareaEl.froalaEditor('html.get');
        //     var insertHtml = [];

        //     if (!html) return;

        //     $(html).find('img').each(function() {
        //         insertHtml.push(this.outerHTML);
        //     });
        //     insertHtml = insertHtml.join('');

        //     setCacheData(insertHtml);
        //     initEditor();
        // });
    });
</script>